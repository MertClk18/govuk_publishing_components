<%
  add_gem_component_stylesheet("password-input")

  label_text ||= t("components.password_input.label")

  error_text ||= nil
  error_text_prefix ||= t("components.password_input.error_text_prefix")

  shared_helper = GovukPublishingComponents::Presenters::SharedHelper.new(local_assigns)
  component_helper = GovukPublishingComponents::Presenters::ComponentWrapperHelper.new(local_assigns)
  component_helper.add_data_attribute({ module: "govuk-password-input" })
  component_helper.add_class('govuk-form-group')
  component_helper.add_class('govuk-form-group--error') if error_text
  component_helper.add_class('govuk-password-input')
  component_helper.add_class('gem-c-password-input')
  component_helper.add_class(shared_helper.get_margin_bottom)

  uid = SecureRandom.hex(4)

  label_for = uid + '-password-input'

  input_name = 'password'
  input_id = uid + '-password-input'

  aria_controls = uid + '-password-input'

  input_classes = %w(govuk-input govuk-password-input__input govuk-js-password-input-input)

  if error_text
    label_for << '-with-error-message'
    input_id << '-with-error-message'
    input_name << '-input-with-error-message'
    input_classes << 'govuk-input--error'
    aria_controls << '-with-error-message'
    paragraph_id = uid + '-password-input-with-error-message-error'
  end

%>

<%= tag.div(**component_helper.all_attributes) do %>
  <%= render "govuk_publishing_components/components/label", {
    text: label_text,
    html_for: label_for
  } %>
  <% if error_text %>
    <p id="<%= paragraph_id %>" class="govuk-error-message">
      <span class="govuk-visually-hidden"><%= error_text_prefix %>:</span> <%= error_text %>
    </p>
  <% end %>

  <div class="govuk-input__wrapper govuk-password-input__wrapper">
    <%= tag.input(
      name: input_name,
      type: "password",
      class: input_classes,
      id: input_id,
      spellcheck: false,
      autocomplete: "current-password",
      autocapitalize: "none",
      aria: {
        describedby: paragraph_id
      }) %>

    <%= tag.button(
      type: "button",
      class: "govuk-button govuk-button--secondary govuk-password-input__toggle govuk-js-password-input-toggle",
      data: {
        module: "govuk-button"
      },
      hidden: true,
      aria: {
        controls: aria_controls,
        label: t("components.password_input.button_aria_label")
      }) do %>
        <%= t("components.password_input.button") %>
      <% end %>
  </div>
<% end %>
